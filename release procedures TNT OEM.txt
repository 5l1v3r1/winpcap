$Header: /usr/cvsroot/winpcap_oem/release\040procedures\040TNT\040OEM.txt,v 1.4 2006/09/13 12:32:23 gianlucav Exp $
OEM WINPCAP TOOLKIT RELEASE PROCEDURE
=====================================

Needed tools
------------
- Visual Studio .NET 2003
- The cygnus environment on your path (needed to execute step 10 and 11).


Dependencies
------------
- you need to have the Airpcap developer's pack in 
	  %BUILD_TREE%\Airpcap_Devpack


How to compile OEM WinPcap for the toolkit.
-------------------------------------------

1.  Download winpcap (HEAD) and winpcap_oem from the CVS into %BUILD_TREE%

2.  Modify the version info into
 	  %BUILD_TREE%\winpcap_oem\version.h. 
    the version for the TNT is x.y.1.z. The variable
	  WINPCAPOEM_VER_STRING
    should be modified adding a ".tnt" at the end of the numbers.

3.  Modify the device string into
	  %BUILD_TREE%\winpcap\common\wpcapnames.h (first two defines)

4.  Download the libpcap sources (usually 0_9 branch) into 
	  %BUILD_TREE%\libpcap_<version>

5.  Commit %BUILD_TREE%\winpcap_oem\version.h into the CVS. This should be the 
    *only* modified file in this module.

6.  Tag the %BUILD_TREE%\winpcap_oem module with the tag 
	  OEM_WINPCAP_<version>_TNT_<TNT version>

7.  Tag the %BUILD_TREE%\winpcap module with the tag 
	  OEM_WINPCAP_<version>_TNT_<TNT version>

8.  Take the contents of %BUILD_TREE%\libpcap_<version> and copy it into
	  %BUILD_TREE%\winpcap\wpcap\libpcap 

9.  From the command line, go to folder 
      %BUILD_TREE%\winpcap\wpcap\libpcap

10. On the command line, type "patch -p1 < remote_code.patch"

11. CD into %BUILD_TREE%\winpcap\wpcap\prj and execute 
	"build_scanner_parser.bat"	

12. Check that the version of libpcap in
      %BUILD_TREE%\winpcap\wpcap\libpcap\pcap.c line 865
      "static const char pcap_version_string[] = "libpcap version 0.9[.x]";"
    makes sense (??? WHAT DOES IT MEAN???)

13. Check that the version of wpcap in  
      %BUILD_TREE%\winpcap\wpcap\libpcap\pcap.c line 875
        "static const char wpcap_version_string[] = "3.1";"
    is correct. 
    

14. Zip the contents of the four folders 
	  %BUILD_TREE%\winpcap_oem
	  %BUILD_TREE%\winpcap
	  %BUILD_TREE%\libpcap_<libpcap_version>
	  %BUILD_TREE%\AirPcap_Devpack
		  |
		  V
	  %BUILD_TREE%\sources.zip

15. Open a Win 2000 DDK Free build environment. Go into 
	  %BUILD_TREE%\winpcap_oem\packetntx. 
	Execute "compileDriver.bat". Prefast 1.5.2402 should issue 8 warnings 
	(20060710). 
	Close the build environment.
    NOTE: DO NOT EXECUTE 15. 16. and 17. at the same time, they overwrite files in 
    the build process that are incompatible between the two builds.

16. Open the WinNT4 DDK Release build environment. Go into 
      %BUILD_TREE%\winpcap_oem\packetntx. 
    Execute "compileDriver.bat". Close the build 
    environment. 
    NOTE: DO NOT EXECUTE 15. 16. and 17. at the same time, they overwrite files in 
    the build process that are incompatible between the two builds.

17. Open the Windows Server 2003 Free x64 build environment. Go into 
      %BUILD_TREE%\winpcap_oem\packetntx. 
    Execute "compileDriver.bat". Close the build 
    environment. 
    NOTE: DO NOT EXECUTE 15. 16. and 17. at the same time, they overwrite files in 
    the build process that are incompatible between the two builds.

18. Open %BUILD_TREE%\winpcap_oem\WinPcap OEM.sln with Visual Studio 2003. 
    Choose the Release_TNT configuration, and then use Build->Rebuild Solution.
    Some warnings should be issued related to the wpcap.dll project, only.
    If you choose the Debug configuration, and then use Build->Rebuild Solution, the 
    compilation will fail because the debug version of the NT4 driver is missing. Repeat
    step 16 choosing the NT4 Checked build environment.
    Close Visual Studio.

19. The build is complete.
	The DLLs are in the following folders:

		%BUILD_TREE%\winpcap_oem\wpcap\PRJ\release_REMOTE_TNT\wpcap.dll
		%BUILD_TREE%\winpcap_oem\OEM\WinpcapOem\Release_TNT\packet.dll

20. Check the DLLs/SYSs files for the versions
		%BUILD_TREE%\winpcap_oem\wpcap\PRJ\release_REMOTE_TNT\wpcap.dll
		%BUILD_TREE%\winpcap_oem\OEM\WinpcapOem\Release_TNT\packet.dll
		%BUILD_TREE%\winpcap_oem\OEM\WinpcapOem\binaries\npf2k.sys
		%BUILD_TREE%\winpcap_oem\OEM\WinpcapOem\binaries\npfx64.sys
		%BUILD_TREE%\winpcap_oem\OEM\WinpcapOem\binaries\npfnt.sys
		%BUILD_TREE%\winpcap_oem\OEM\WinpcapOem\binaries\packet2k.sys
		%BUILD_TREE%\winpcap_oem\OEM\WinpcapOem\binaries\packetnt.sys


SCM procedures
--------------

1.  %BUILD_TREE%\winpcap_oem\wpcap\PRJ\release_REMOTE_TNT\wpcap.dll
	%BUILD_TREE%\winpcap_oem\OEM\WinpcapOem\Release_TNT\packet.dll
		|
		v
	OEM_WinPcap_<version>_TNT_<TNT version>_Binaries.zip

2. 	%BUILD_TREE%\Sources.zip
		|
		V
	OEM_WinPcap_<version>_TNT_<TNT version>_Sources.zip

3.	%BUILD_TREE%\winpcap_oem
	%BUILD_TREE%\winpcap
	%BUILD_TREE%\libpcap_<libpcap_version>
	%BUILD_TREE%\Airpcap_Devpack
		|
		V
	OEM_WinPcap_<version>_TNT_<TNT version>_Build_Tree.zip
		
		
MD5sum
------

1.  Open a command prompt and go into %BUILD_TREE%

2.  Type md5sum.exe OEM_* > md5sum.txt

		