$Header: /usr/cvsroot/winpcap_oem/release\040procedures\040WOEM.txt,v 1.15 2008/08/18 22:37:43 gianlucav Exp $

WINPCAP PRO RELEASE PROCEDURE
=============================

NOTE (GV20070122): the procedure has NOT been tested thoroughly in case
of non-signed builds.

Needed tools
------------

- Visual Studio .NET 2005 SP1 (both x86 and x64 build environments)
- WDK 6000.
- The cygnus environment on your path (needed to execute step 11 and 12).
   In particular you will need to have flex, bison, patch.
- Doxygen 1.5.4 installed and on the path

Dependencies
------------
- you need to have the Airpcap developer's pack in 
	  %BUILD_TREE%\Airpcap_Devpack
- you need to have the NpfIm compiled sources in
	  %BUILD_TREE%\NpfIm
	  You should also have run the "NpfIm\build_dev_pack.bat" script
	  to have the devpacks ready

How to compile WinPcap PRO (NOT for the Toolkit)
------------------------------------------------

1.  Download winpcap (HEAD) and winpcap_oem from the CVS into %BUILD_TREE%

2.  Modify the version info into
	  %BUILD_TREE%\winpcap_oem\version.h. The version is x.y.2.z

3.  Modify the documentation version in the file
	  %BUILD_TREE%\winpcap_oem\dox\prj\winpcap_oem_noc.dox
	  
4.  Modify the device string into
	  %BUILD_TREE%\winpcap\common\wpcapnames.h (first two defines)

5.  Download the libpcap sources (usually 0_9 branch) into 
	  %BUILD_TREE%\libpcap_<version>

6.  Be sure that the sources of libpcap do *not* contain any CVS folder. The tarball usually
    contains the CVS folders if it's a daily snapshot. If any, remove them.

7.  Commit 

		%BUILD_TREE%\winpcap_oem\version.h
		%BUILD_TREE%\winpcap_oem\dox\prj\winpcap_oem_noc.dox 
	
	into the CVS. These should be the *only* modified filew in this module.

8.  Tag the %BUILD_TREE%\winpcap_oem module with the tag 
	  WINPCAP_PRO_<WinPcap PRO version>_PUBLIC

9.  Tag the %BUILD_TREE%\winpcap module with the tag 
	  WINPCAP_PRO_<WinPcap PRO version>_PUBLIC

10. Take the contents of %BUILD_TREE%\libpcap_<version> and copy it into
	  %BUILD_TREE%\winpcap\wpcap\libpcap 

11. From the command line, go to folder 
      %BUILD_TREE%\winpcap\wpcap\libpcap

12. On the command line, type "patch -p1 < remote_code.patch"

13. CD into %BUILD_TREE%\winpcap\wpcap\prj and execute 
	"build_scanner_parser.bat"	

14. Check that the version of libpcap in
      %BUILD_TREE%\winpcap\wpcap\libpcap\pcap.c line 869
      "static const char pcap_version_string[] = "libpcap version 0.9[.x]";"
    makes sense (??? WHAT DOES IT MEAN???)

15. Check that the version of wpcap in  
      %BUILD_TREE%\winpcap\wpcap\libpcap\pcap.c line 878
        "static const char wpcap_version_string[] = "3.1";"
    is correct. 
    
16. Zip the contents of the 5 folders 
	  %BUILD_TREE%\winpcap_oem
	  %BUILD_TREE%\winpcap
	  %BUILD_TREE%\libpcap_<libpcap_version>
	  %BUILD_TREE%\Airpcap_Devpack
	  %BUILD_TREE%\NpfIm
		  |
		  V
	  %BUILD_TREE%\sources.zip

17. Open a Win 2000 DDK Free build environment. Go into 
	  %BUILD_TREE%\winpcap_oem\packetntx. 
	Execute "compileDriver.bat". Prefast 8.0.86081 should issue 21 warnings 
	(20080821). 
	Close the build environment.

18. Open the WinNT4 DDK Release build environment. Go into 
      %BUILD_TREE%\winpcap_oem\packetntx. 
    Execute "compileDriver.bat". Close the build 
    environment. 
19. Open the Windows Server 2003 Free x64 build environment. Go into 
      %BUILD_TREE%\winpcap_oem\packetntx. 
    Execute "compileDriver.bat". Close the build 
    environment. 

20. Open %BUILD_TREE%\winpcap_oem\MakeAll.sln with Visual Studio 2005 SP1.

21. Choose the "Release|Win32" configuration, and then use Build->Rebuild Solution.
    No warnings should be generated.

22. Choose the "Release|X64" configuration, and then use Build->Rebuild Solution.
    No warnings should be generated.
    
23. If you are NOT building a SIGNED build, the build is complete :-)

24. Sign all the binaries in 
		%BUILD_TREE%\winpcap_oem\OEM\WinPcapOem\Binaries, namely
			x86\npfnt.sys
			x86\npf2k.sys
			x86\packetnt.dll
			x86\packet2k.dll
			x86\packetVista.dll
			x64\npfx64.sys
			x64\packet2k.dll
			x64\packetVista.dll
		with the company certificate + cross certificate
		
		The generic command is
		   signtool sign /v /ac MSCV-VSClass3.cer /s my /n "CACE Technologies, Inc."
		   /t http://timestamp.verisign.com/scripts/timestamp.dll <binary_name>
		   
25. Go back to Visual studio 2005. Choose the "Release STEP2|Win32" configuration, and then
     use Build->Rebuild solution. 
     IT IS IMPERATIVE THAT YOU CHOOSE "REBUILD" SO THAT THE SIGNED BINARIES ARE USED.

26. Choose the "Release STEP2|x64" configuration, and then use Build->Rebuild solution. 
     IT IS IMPERATIVE THAT YOU CHOOSE "REBUILD" SO THAT THE SIGNED BINARIES ARE USED.

27. Sign the following binaries 
		%BUILD_TREE%\winpcap_oem\wpcap\PRJ\Release REMOTE\x86\wpcap.dll
		%BUILD_TREE%\winpcap_oem\wpcap\PRJ\Release REMOTE\x64\wpcap.dll
		%BUILD_TREE%\winpcap_oem\OEM\WinpcapOem\Release\x86\packet.dll
		%BUILD_TREE%\winpcap_oem\OEM\WinpcapOem\Release\x64\packet.dll
		with the company certificate + cross certificate

28. The build is complete.

How to create the developer's pack for WinPcap PRO (NOT for the Toolkit)
------------------------------------------------------------------------

1. After the build is complete, in a command prompt go to 
		
		%BUILD_TREE%\winpcap_oem

2. Run "build_wpdpack_oem.bat". The script will perform these
	steps without pauses:
	a. Creation of the include folder (no errors/warnings)
	b. Creation of the lib folder (no errors/warnings)
	c. Creation of the bin folder (no errors/warnings)
	d. Creation of the Examples and Examples-pcap folders (no errors/warnings)
	e. creation of the documentation. One error copying some *.gif files is reported.

How to create the developer's pack for WinPcap PRO (NOT for the Toolkit) with NpfIm loading support (IBM)
---------------------------------------------------------------------------------------------------------

TO BE UPDATED (GV20080818)

1. After the build is completed, in a command prompt go to 
		
		%BUILD_TREE%\winpcap_oem

2. Run "build_wpdpack_oem_with_npfim.bat". The script will perform these
	steps without pauses:
	a. Creation of the include folder (no errors/warnings)
	b. Creation of the lib folder (no errors/warnings)
	c. Creation of the bin folder (no errors/warnings)
	d. Creation of the Examples and Examples-pcap folders (no errors/warnings)
	e. creation of the documentation. One error copying some *.gif files is reported.
   f. copy of the NpfIm files.

SCM procedures
--------------

NpfIm BUILD:
TO BE UPDATED (GV20080818)
1a.  %BUILD_TREE%\winpcap_oem\wpdpack_NpfIm\
		|
		v
	WinPcapPro_<WinPcap Pro version>_WpdPackNpfIm.zip

Vanilla BUILD:
1a.  %BUILD_TREE%\winpcap_oem\wpdpack\
		|
		v
	WinPcapPro_<WinPcap Pro version>_WpdPack.zip


2. 	%BUILD_TREE%\Sources.zip
		|
		V
	WinPcapPro_<WinPcap Pro version>_Sources.zip

3.	%BUILD_TREE%\winpcap_oem
	%BUILD_TREE%\winpcap
	%BUILD_TREE%\libpcap_<libpcap_version>
	%BUILD_TREE%\Airpcap_Devpack
	%BUILD_TREE%\NpfIm
		|
		V
	WinPcapPro_<WinPcap Pro version>_BuildTree.zip
		
		
MD5sum
------

1.  Open a command prompt and go into %BUILD_TREE%

2.  Type md5sum.exe WinPcapPro_* > md5sum.txt

