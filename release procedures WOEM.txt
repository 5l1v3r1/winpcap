$Header: /usr/cvsroot/winpcap_oem/release\040procedures\040WOEM.txt,v 1.9 2006/11/27 21:41:22 gianlucav Exp $

OEM WINPCAP RELEASE PROCEDURE
=============================

Needed tools
------------

- Visual Studio .NET 2003
- The cygnus environment on your path (needed to execute step 11 and 12).
   In particular you will need to have flex, bison, patch.
- Doxygen 1.3.7 installed and on the path

Dependencies
------------
- you need to have the Airpcap developer's pack in 
	  %BUILD_TREE%\Airpcap_Devpack
- you need to have the NpfIm compiled sources in
	  %BUILD_TREE%\NpfIm
	  You should also have run the "NpfIm\build_dev_pack.bat" script
	  to have the devpacks ready

How to compile OEM WinPcap (NOT for the Toolkit)
------------------------------------------------

1.  Download winpcap (HEAD) and winpcap_oem from the CVS into %BUILD_TREE%

2.  Modify the version info into
	  %BUILD_TREE%\winpcap_oem\version.h. The version is x.y.2.z

3.  Modify the doxumentation version in the file
	  %BUILD_TREE%\winpcap_oem\dox\prj\winpcap_oem_noc.dox
	  
4.  Modify the device string into
	  %BUILD_TREE%\winpcap\common\wpcapnames.h (first two defines)

5.  Download the libpcap sources (usually 0_9 branch) into 
	  %BUILD_TREE%\libpcap_<version>

6. Be sure that the sources of libpcap do *not* contain any CVS folder. The tarball usually
    contains the CVS folders if it's a daily snapshot. If any, remove them.

7.  Commit 

		%BUILD_TREE%\winpcap_oem\version.h
		%BUILD_TREE%\winpcap_oem\dox\prj\winpcap_oem_noc.dox 
	
	into the CVS. These should be the *only* modified filew in this module.

8.  Tag the %BUILD_TREE%\winpcap_oem module with the tag 
	  OEM_WINPCAP_<OEM version>_WOEM

9.  Tag the %BUILD_TREE%\winpcap module with the tag 
	  OEM_WINPCAP_<OEM version>_WOEM

10. Take the contents of %BUILD_TREE%\libpcap_<version> and copy it into
	  %BUILD_TREE%\winpcap\wpcap\libpcap 

11. From the command line, go to folder 
      %BUILD_TREE%\winpcap\wpcap\libpcap

12. On the command line, type "patch -p1 < remote_code.patch"

13. CD into %BUILD_TREE%\winpcap\wpcap\prj and execute 
	"build_scanner_parser.bat"	

13a. Check that the version of libpcap in
      %BUILD_TREE%\winpcap\wpcap\libpcap\pcap.c line 865
      "static const char pcap_version_string[] = "libpcap version 0.9[.x]";"
    makes sense (??? WHAT DOES IT MEAN???)

13b. Check that the version of wpcap in  
      %BUILD_TREE%\winpcap\wpcap\libpcap\pcap.c line 875
        "static const char wpcap_version_string[] = "3.1";"
    is correct. 
    
14. Zip the contents of the six folders 
	  %BUILD_TREE%\winpcap_oem
	  %BUILD_TREE%\winpcap
	  %BUILD_TREE%\libpcap_<libpcap_version>
	  %BUILD_TREE%\Airpcap_Devpack
	  %BUILD_TREE%\NpfIm
		  |
		  V
	  %BUILD_TREE%\sources.zip

15. Open a Win 2000 DDK Free build environment. Go into 
	  %BUILD_TREE%\winpcap_oem\packetntx. 
	Execute "compileDriver.bat". Prefast 1.5.2402 should issue 9 warnings 
	(20061127). 
	Close the build environment.
    NOTE: DO NOT EXECUTE 15. and 16. and 17. at the same time, they overwrite files in 
    the build process that are incompatible between the two builds.

16. Open the WinNT4 DDK Release build environment. Go into 
      %BUILD_TREE%\winpcap_oem\packetntx. 
    Execute "compileDriver.bat". Close the build 
    environment. 
    NOTE: DO NOT EXECUTE 15. and 16. and 17. at the same time, they overwrite files in 
    the build process that are incompatible between the two builds.

17. Open the Windows Server 2003 Free x64 build environment. Go into 
      %BUILD_TREE%\winpcap_oem\packetntx. 
    Execute "compileDriver.bat". Close the build 
    environment. 
    NOTE: DO NOT EXECUTE 15. and 16. and 17. at the same time, they overwrite files in 
    the build process that are incompatible between the two builds.

18. Open %BUILD_TREE%\winpcap_oem\WinPcap OEM.sln with Visual Studio 2003. 
    Choose the Release configuration, and then use Build->Rebuild Solution.
    Some warnings should be issued only for the Wpcap.dll project.
    If you choose the Debug configuration, and then use Build->Rebuild Solution, the 
    compilation will fail beacuse the debug version of the NT4 driver is missing. Repeat
    step 16 choosing the NT4 Checked build environment.
    Close Visual Studio.

19. The build is complete.
	The DLLs are in the following folders:

		%BUILD_TREE%\winpcap_oem\wpcap\PRJ\release_REMOTE\wpcap.dll
		%BUILD_TREE%\winpcap_oem\OEM\WinpcapOem\Release\packet.dll

20. Check the DLLs/SYSs files for the versions
		%BUILD_TREE%\winpcap_oem\wpcap\PRJ\release_REMOTE\wpcap.dll
		%BUILD_TREE%\winpcap_oem\OEM\WinpcapOem\Release\packet.dll
		%BUILD_TREE%\winpcap_oem\OEM\WinpcapOem\binaries\npf2k.sys
		%BUILD_TREE%\winpcap_oem\OEM\WinpcapOem\binaries\npfnt.sys
		%BUILD_TREE%\winpcap_oem\OEM\WinpcapOem\binaries\npfx64.sys
		%BUILD_TREE%\winpcap_oem\OEM\WinpcapOem\binaries\packet2k.dll
		%BUILD_TREE%\winpcap_oem\OEM\WinpcapOem\binaries\packetnt.dll
		%BUILD_TREE%\winpcap_oem\OEM\WinpcapOem\binaries\packetVista.dll

How to create the developer's pack for OEM WinPcap (NOT for the Toolkit)
------------------------------------------------------------------------

1. After the build is completed, in a command prompt go to 
		
		%BUILD_TREE%\winpcap_oem

2. Run "build_wpdpack_oem.bat". The script will pause after each step of the
   build:
	a. Creation of the include folder (no errors/warnings)
	b. Creation of the lib folder (no errors/warnings)
	c. Creation of the bin folder (no errors/warnings)
	d. Creation of the Examples and Examples-pcap folders (no errors/warnings)
	e. creation of the documentation. One error copying some *.gif files is reported.


How to create the developer's pack for OEM WinPcap (NOT for the Toolkit) with NpfIm loading support (IBM)
---------------------------------------------------------------------------------------------------------

1. After the build is completed, in a command prompt go to 
		
		%BUILD_TREE%\winpcap_oem

2. Run "build_wpdpack_oem_with_npfim.bat". The script will pause after each step of the
   build:
	a. Creation of the include folder (no errors/warnings)
	b. Creation of the lib folder (no errors/warnings)
	c. Creation of the bin folder (no errors/warnings)
	d. Creation of the Examples and Examples-pcap folders (no errors/warnings)
	e. creation of the documentation. One error copying some *.gif files is reported.
   f. copy og the NpfIm files.
	   

SCM procedures
--------------

1.  %BUILD_TREE%\winpcap_oem\wpdpack\
		|
		v
	OEM_WinPcap_<OEM version>_WOEM_WpdPack.zip

2. 	%BUILD_TREE%\Sources.zip
		|
		V
	OEM_WinPcap_<OEM version>_WOEM_Sources.zip

3.	%BUILD_TREE%\winpcap_oem
	%BUILD_TREE%\winpcap
	%BUILD_TREE%\libpcap_<libpcap_version>
	%BUILD_TREE%\Airpcap_Devpack
	%BUILD_TREE%\NpfIm
		|
		V
	OEM_WinPcap_<OEM version>_WOEM_Build_Tree.zip
		
		
MD5sum
------

1.  Open a command prompt and go into %BUILD_TREE%

2.  Type md5sum.exe OEM_* > md5sum.txt

