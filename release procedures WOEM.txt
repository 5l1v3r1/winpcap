OEM WINPCAP RELEASE PROCEDURE
=============================
GV20060222

Needed tools
------------

- Visual Studio .NET 2003
- The cygnus environment on your path (needed to execute step 11 and 12).
   In particular you will need to have flex, bison, patch.
- Doxygen 1.3.7 installed and on the path

How to compile OEM WinPcap (NOT for the Toolkit)
------------------------------------------------

1.  Download winpcap (HEAD) and winpcap_oem from the CVS into %BUILD_TREE%

2.  Modify the version info into
	  %BUILD_TREE%\winpcap_oem\version.h. The version is x.y.2.z

3.  Modify the doxumentation version in the file
	  %BUILD_TREE%\winpcap_oem\dox\prj\winpcap_oem_noc.dox
	  
4.  Modify the device string into
	  %BUILD_TREE%\winpcap\common\wpcapnames.h (first two defines)

5.  Download the libpcap sources (usually 0_9 branch) into 
	  %BUILD_TREE%\libpcap_<version>

6.  Commit 

		%BUILD_TREE%\winpcap_oem\version.h
		%BUILD_TREE%\winpcap_oem\dox\prj\winpcap_oem_noc.dox 
	
	into the CVS. These should be the *only* modified filew in this module.

7.  Tag the %BUILD_TREE%\winpcap_oem module with the tag 
	  OEM_WINPCAP_<OEM version>_WOEM

8.  Tag the %BUILD_TREE%\winpcap module with the tag 
	  OEM_WINPCAP_<OEM version>_WOEM

9.  Take the contents of %BUILD_TREE%\libpcap_<version> and copy it into
	  %BUILD_TREE%\winpcap\wpcap\libpcap 
	(confirm the overwrite operation)

10. From the command line, go to folder 
      %BUILD_TREE%\winpcap\wpcap\libpcap

11. On the command line, type "patch -p1 < remote_code.patch"

12. CD into %BUILD_TREE%\winpcap\wpcap\prj and execute 
	"build_scanner_parser.bat"	

13. Zip the contents of the three folders 
	  %BUILD_TREE%\winpcap_oem
	  %BUILD_TREE%\winpcap
	  %BUILD_TREE%\libpcap_<libpcap_version>
		  |
		  V
	  %BUILD_TREE%\sources.zip

14. Open a Win 2000 DDK Free build environment. Go into 
	  %BUILD_TREE%\winpcap_oem\packetntx. 
	Execute "compileDriver.bat". Prefast 1.5.2402 should issue 9 warnings 
	(20060710). 
	Close the build environment.

15. Open the WinNT4 DDK Release build environment. Go into 
      %BUILD_TREE%\winpcap_oem\packetntx. 
    Execute "compileDriver.bat". Close the build 
    environment. 
    NOTE: DO NOT EXECUTE 14. and 15. at the same time, they overwrite files in 
    the build process that are incompatible between the two builds.

16. Open %BUILD_TREE%\winpcap_oem\WinPcap OEM.sln with Visual Studio 2003. 
    Choose the Debug configuration, and then use Build->Rebuild Solution. 
    Choose the Release configuration, and then use Build->Rebuild Solution.
    Some warnings should be issued only for the Wpcap.dll project.
    Close Visual Studio.

17. The build is complete.
	The DLLs are in the following folders:

		%BUILD_TREE%\winpcap_oem\wpcap\PRJ\release_REMOTE\wpcap.dll
		%BUILD_TREE%\winpcap_oem\OEM\WinpcapOem\Release\packet.dll

18. Check the DLLs/SYSs files for the versions
		%BUILD_TREE%\winpcap_oem\wpcap\PRJ\release_REMOTE\wpcap.dll
		%BUILD_TREE%\winpcap_oem\OEM\WinpcapOem\Release\packet.dll
		%BUILD_TREE%\winpcap_oem\OEM\WinpcapOem\binaries\npf2k.sys
		%BUILD_TREE%\winpcap_oem\OEM\WinpcapOem\binaries\npfnt.sys
		%BUILD_TREE%\winpcap_oem\OEM\WinpcapOem\binaries\packet2k.sys
		%BUILD_TREE%\winpcap_oem\OEM\WinpcapOem\binaries\packetnt.sys

How to create the developer's pack for OEM WinPcap (NOT for the Toolkit)
------------------------------------------------------------------------

1. After the build is completed, in a command prompt go to 
		
		%BUILD_TREE%\winpcap_oem

2. Run "build_wpdpack_oem.bat". The script will pause after each step of the
   build:
	a. Creation of the include folder (no errors/warnings)
	b. Creation of the lib folder (no errors/warnings)
	c. Creation of the bin folder (no errors/warnings)
	d. Creation of the Examples and Examples-pcap folders (no errors/warnings)
	e. creation of the documentation. Some warnings/errors are generated:
	   - a Doxygen warning processing the file winpcap/dox/libpcap/funcs/pcap.h
	   - an error copying some *.gif files.
	   

SCM procedures
--------------

1.  %BUILD_TREE%\winpcap_oem\wpdpack\
		|
		v
	OEM_WinPcap_<OEM version>_WOEM_WpdPack.zip

2. 	%BUILD_TREE%\Sources.zip
		|
		V
	OEM_WinPcap_<OEM version>_WOEM_Sources.zip

3.  %BUILD_TREE%\
		|
		V
	OEM_WinPcap_<OEM version>_WOEM_Build_Tree.zip
		